<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM_Win11_RE的个人网站</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav class="container">
            <h1 class="logo">SYSTEM_Win11_RE的个人网站</h1>
            <ul class="nav-links" id="nav-links">
                <li><a href="index.html" class="active">首页</a></li>
                <li><a href="about.html">关于</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <section class="hero">
            <h2>欢迎来到SYSTEM_Win11_RE的个人网站</h2>
            <p>本网站仅供学习交流</p>
        </section>

        <!-- 分类筛选 -->
        <div class="category-filter">
            <button class="filter-btn active" data-category="all">全部</button>
            <!-- 分类将从 posts/index.json 动态加载 -->
        </div>

        <section class="posts" id="posts-container">
            <!-- 文章列表将通过 JavaScript 动态加载 -->
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 SYSTEM_Win11_RE. 保留所有权利.</p>
        </div>
    </footer>

    <script src="js/static-loader.js"></script>
    <script src="js/bing-wallpaper.js"></script>
    <script>
        // 页面初始化
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('页面加载完成，开始初始化...');
            
            // 1. 加载文章列表
            await loadStaticPosts();
            console.log('文章列表加载完成');
            
            // 2. 动态加载分类筛选器
            try {
                const posts = await loadPostsFromJSON();
                console.log('读取到文章数量:', posts.length);
                
                // 从文章中提取所有唯一的分类
                const categories = [...new Set(posts.map(p => p.category).filter(Boolean))];
                console.log('提取到的分类:', categories);
                
                // 按字母顺序排序
                categories.sort((a, b) => a.localeCompare(b, 'zh-CN'));
                
                const filterContainer = document.querySelector('.category-filter');
                
                if (filterContainer) {
                    // 保留"全部"按钮
                    filterContainer.innerHTML = '<button class="filter-btn active" data-category="all">全部</button>';
                    
                    // 添加动态分类按钮
                    if (categories.length > 0) {
                        categories.forEach(category => {
                            const btn = document.createElement('button');
                            btn.className = 'filter-btn';
                            btn.dataset.category = category;
                            btn.textContent = category;
                            filterContainer.appendChild(btn);
                        });
                        console.log('分类按钮已添加');
                    }
                    
                    // 设置分类筛选事件
                    setupStaticCategoryFilter();
                    console.log('分类筛选事件已绑定');
                }
            } catch (error) {
                console.error('加载分类失败:', error);
            }
            
            // 3. 应用必应每日一图背景
            try {
                await applyBingWallpaperToBody({
                    overlay: true,
                    overlayColor: 'rgba(255, 255, 255, 0.1)'
                });
                document.body.classList.add('has-wallpaper');
                console.log('背景图片已应用');
            } catch (error) {
                console.error('背景图片加载失败:', error);
            }
        });
    </script>
</body>
</html>
