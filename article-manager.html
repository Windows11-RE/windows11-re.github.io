<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« ç®¡ç†å™¨</title>
    <!-- Quill å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
    <link href="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.snow.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* å·¦ä¾§æ–‡ç« åˆ—è¡¨ */
        .sidebar {
            width: 300px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-header h1 {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
        }

        .batch-mode-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
        }

        .batch-mode-toggle input[type="checkbox"] {
            cursor: pointer;
        }

        .batch-mode-toggle label {
            cursor: pointer;
            font-size: 14px;
            color: #666;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .article-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .article-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .article-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .article-item.active {
            background: #e3f2fd;
            border-left-color: #667eea;
        }

        .article-item.selected {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .article-checkbox {
            display: none;
            cursor: pointer;
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .batch-mode .article-checkbox {
            display: block;
        }

        .article-info {
            flex: 1;
            min-width: 0;
        }

        .article-item h3 {
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .article-item .meta {
            font-size: 12px;
            color: #999;
        }

        .article-item .category {
            display: inline-block;
            padding: 2px 8px;
            background: #667eea;
            color: white;
            border-radius: 3px;
            font-size: 11px;
            margin-right: 5px;
        }

        /* ä¸­é—´ç¼–è¾‘åŒº */
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .editor-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .editor-title {
            font-size: 18px;
            color: #333;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
        }

        .editor-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .editor-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Quill ç¼–è¾‘å™¨æ ·å¼ */
        #editor-container {
            height: 400px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .ql-container {
            font-size: 15px;
        }

        /* å³ä¾§é¢„è§ˆåŒº */
        .preview-area {
            width: 400px;
            background: white;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .preview-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .preview-header h2 {
            font-size: 16px;
            color: #333;
        }

        .preview-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f9fa;
        }

        .preview-article {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .preview-article h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
        }

        .preview-article .meta {
            color: #999;
            font-size: 13px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .preview-article .content {
            line-height: 1.8;
            color: #333;
        }

        .preview-article .content h2 {
            font-size: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .preview-article .content h3 {
            font-size: 18px;
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .preview-article .content p {
            margin-bottom: 15px;
        }

        .preview-article .content img {
            max-width: 100%;
            border-radius: 4px;
            margin: 15px 0;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
        }

        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        /* çŠ¶æ€æç¤º */
        .status-bar {
            padding: 10px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-saved {
            color: #27ae60;
        }

        .status-unsaved {
            color: #e74c3c;
        }

        /* æ‰¹é‡æ“ä½œ */
        .batch-actions {
            padding: 15px;
            background: #fff3cd;
            border-top: 1px solid #ffc107;
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .batch-actions.active {
            display: flex;
        }

        .batch-actions-info {
            font-size: 14px;
            color: #856404;
            font-weight: 500;
        }

        .batch-actions-buttons {
            display: flex;
            gap: 10px;
        }

        .batch-actions button {
            flex: 1;
            padding: 8px 12px;
            font-size: 13px;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* å“åº”å¼ */
        @media (max-width: 1200px) {
            .preview-area {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: absolute;
                z-index: 100;
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§æ–‡ç« åˆ—è¡¨ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>ğŸ“ æ–‡ç« ç®¡ç†å™¨</h1>
                <div class="batch-mode-toggle" onclick="toggleBatchMode()">
                    <input type="checkbox" id="batch-mode-checkbox">
                    <label for="batch-mode-checkbox">æ‰¹é‡é€‰æ‹©</label>
                </div>
                <button class="btn" onclick="createNewArticle()">+ æ–°å»ºæ–‡ç« </button>
                <button class="btn btn-secondary" onclick="importFromRepository()" style="margin-top: 10px;">
                    ğŸ“¥ ä»ä»“åº“å¯¼å…¥
                </button>
            </div>
            <div class="article-list" id="article-list">
                <!-- æ–‡ç« åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            <div class="batch-actions" id="batch-actions">
                <div class="batch-actions-info">
                    å·²é€‰æ‹© <span id="selected-count">0</span> ç¯‡æ–‡ç« 
                </div>
                <div class="batch-actions-buttons">
                    <button class="btn btn-secondary" onclick="selectAllArticles()">å…¨é€‰</button>
                    <button class="btn btn-secondary" onclick="deselectAllArticles()">å–æ¶ˆ</button>
                    <button class="btn btn-danger" onclick="deleteSelectedArticles()">ğŸ—‘ï¸ åˆ é™¤</button>
                </div>
            </div>
            <div style="padding: 15px; border-top: 1px solid #e0e0e0;">
                <button class="btn btn-success" onclick="generateAllHTML()">ğŸ“¦ ç”Ÿæˆæ‰€æœ‰ HTML</button>
                <button class="btn btn-secondary" onclick="exportIndexJSON()" style="margin-top: 10px;">ğŸ“„ å¯¼å‡º index.json</button>
            </div>
        </div>

        <!-- ä¸­é—´ç¼–è¾‘åŒº -->
        <div class="editor-area">
            <div class="editor-header">
                <div class="editor-title" id="editor-title">é€‰æ‹©æˆ–åˆ›å»ºä¸€ç¯‡æ–‡ç« </div>
                <div class="editor-actions">
                    <button class="btn btn-secondary" onclick="togglePreview()">ğŸ‘ï¸ é¢„è§ˆ</button>
                    <button class="btn" onclick="saveCurrentArticle()">ğŸ’¾ ä¿å­˜</button>
                    <button class="btn btn-success" onclick="generateCurrentHTML()">ğŸ“„ ç”Ÿæˆ HTML</button>
                </div>
            </div>

            <div class="editor-content" id="editor-content">
                <div class="empty-state">
                    <div class="icon">ğŸ“</div>
                    <p>é€‰æ‹©ä¸€ç¯‡æ–‡ç« å¼€å§‹ç¼–è¾‘ï¼Œæˆ–åˆ›å»ºæ–°æ–‡ç« </p>
                </div>
            </div>

            <div class="status-bar">
                <span id="status-text">å°±ç»ª</span>
                <span id="article-count">å…± 0 ç¯‡æ–‡ç« </span>
            </div>
        </div>

        <!-- å³ä¾§é¢„è§ˆåŒº -->
        <div class="preview-area" id="preview-area">
            <div class="preview-header">
                <h2>ğŸ“± å®æ—¶é¢„è§ˆ</h2>
            </div>
            <div class="preview-content" id="preview-content">
                <div class="empty-state">
                    <div class="icon">ğŸ‘€</div>
                    <p>å¼€å§‹ç¼–è¾‘ä»¥æŸ¥çœ‹é¢„è§ˆ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quill ç¼–è¾‘å™¨ -->
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.6/dist/quill.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let articles = [];
        let currentArticle = null;
        let quillEditor = null;
        let autoSaveTimer = null;
        let batchMode = false;
        let selectedArticles = new Set();

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadArticles();
            renderArticleList();
        });

        // åŠ è½½æ–‡ç« 
        function loadArticles() {
            const saved = localStorage.getItem('articles');
            articles = saved ? JSON.parse(saved) : [];
            updateArticleCount();
        }

        // ä¿å­˜æ–‡ç« åˆ° localStorage
        function saveArticles() {
            localStorage.setItem('articles', JSON.stringify(articles));
            updateArticleCount();
        }

        // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
        function renderArticleList() {
            const listEl = document.getElementById('article-list');
            
            if (articles.length === 0) {
                listEl.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><p>è¿˜æ²¡æœ‰æ–‡ç« </p></div>';
                return;
            }

            listEl.className = 'article-list' + (batchMode ? ' batch-mode' : '');

            listEl.innerHTML = articles.map((article, index) => {
                const isSelected = selectedArticles.has(article.id);
                const isActive = currentArticle && currentArticle.id === article.id;
                
                return `
                    <div class="article-item ${isActive ? 'active' : ''} ${isSelected ? 'selected' : ''}" 
                         onclick="handleArticleClick(${index}, event)">
                        <input type="checkbox" class="article-checkbox" 
                               ${isSelected ? 'checked' : ''}
                               onclick="toggleArticleSelection(${index}, event)">
                        <div class="article-info">
                            <h3>${article.title || 'æ— æ ‡é¢˜'}</h3>
                            <div class="meta">
                                <span class="category">${article.category || 'æœªåˆ†ç±»'}</span>
                                <span>${article.date || ''}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            updateSelectedCount();
        }

        // åˆ›å»ºæ–°æ–‡ç« 
        function createNewArticle() {
            const newArticle = {
                id: Date.now(),
                title: '',
                category: '',
                author: 'åšä¸»',
                date: new Date().toLocaleDateString('zh-CN').replace(/\//g, '-'),
                excerpt: '',
                coverImage: '',
                content: '',
                visibility: 'public'
            };

            articles.unshift(newArticle);
            saveArticles();
            renderArticleList();
            loadArticle(0);
        }

        // åŠ è½½æ–‡ç« åˆ°ç¼–è¾‘å™¨
        function loadArticle(index) {
            currentArticle = articles[index];
            
            // æ˜¾ç¤ºç¼–è¾‘è¡¨å•
            const editorContent = document.getElementById('editor-content');
            editorContent.innerHTML = `
                <div class="form-group">
                    <label>æ–‡ç« æ ‡é¢˜ *</label>
                    <input type="text" id="input-title" value="${currentArticle.title}" 
                           placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜" oninput="updatePreview()">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>åˆ†ç±» *</label>
                        <input type="text" id="input-category" value="${currentArticle.category}" 
                               placeholder="æŠ€æœ¯/æ•™ç¨‹/éšç¬”" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>ä½œè€…</label>
                        <input type="text" id="input-author" value="${currentArticle.author}" 
                               placeholder="ä½œè€…åç§°" oninput="updatePreview()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>æ—¥æœŸ</label>
                        <input type="text" id="input-date" value="${currentArticle.date}" 
                               placeholder="YYYY-MM-DD">
                    </div>
                    <div class="form-group">
                        <label>å¯è§æ€§</label>
                        <select id="input-visibility">
                            <option value="public" ${currentArticle.visibility === 'public' ? 'selected' : ''}>å…¬å¼€</option>
                            <option value="private" ${currentArticle.visibility === 'private' ? 'selected' : ''}>ç§å¯†</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>æ‘˜è¦ *</label>
                    <textarea id="input-excerpt" rows="2" placeholder="æ–‡ç« æ‘˜è¦">${currentArticle.excerpt}</textarea>
                </div>

                <div class="form-group">
                    <label>å°é¢å›¾ç‰‡</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button type="button" class="btn" style="flex: 1;" onclick="document.getElementById('cover-file-input').click()">
                            ğŸ“ ä¸Šä¼ æœ¬åœ°å›¾ç‰‡
                        </button>
                        <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="inputCoverURL()">
                            ğŸ”— è¾“å…¥ URL
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearCoverImage()">
                            âœ• æ¸…é™¤
                        </button>
                    </div>
                    <input type="file" id="cover-file-input" accept="image/*" style="display: none;" onchange="handleCoverUpload(event)">
                    <input type="text" id="input-cover" value="${currentArticle.coverImage}" 
                           placeholder="å›¾ç‰‡ URL æˆ– Base64" style="display: none;">
                    <div id="cover-preview" style="display: ${currentArticle.coverImage ? 'block' : 'none'}; margin-top: 10px;">
                        <img src="${currentArticle.coverImage}" alt="å°é¢é¢„è§ˆ" style="max-width: 100%; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>

                <div class="form-group">
                    <label>æ–‡ç« å†…å®¹ *</label>
                    <div id="editor-container"></div>
                </div>
            `;

            // åˆå§‹åŒ– Quill ç¼–è¾‘å™¨
            initQuillEditor();
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('editor-title').textContent = currentArticle.title || 'ç¼–è¾‘æ–‡ç« ';
            
            // æ›´æ–°é¢„è§ˆ
            updatePreview();
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨ï¼ˆæ›´æ–°é€‰ä¸­çŠ¶æ€ï¼‰
            renderArticleList();
        }

        // åˆå§‹åŒ– Quill ç¼–è¾‘å™¨
        function initQuillEditor() {
            quillEditor = new Quill('#editor-container', {
                theme: 'snow',
                modules: {
                    toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['blockquote', 'code-block'],
                        ['link', 'image'],
                        ['clean']
                    ]
                },
                placeholder: 'å¼€å§‹ç¼–å†™æ–‡ç« å†…å®¹...'
            });

            // åŠ è½½å†…å®¹
            if (currentArticle.content) {
                quillEditor.root.innerHTML = currentArticle.content;
            }

            // ç›‘å¬å˜åŒ–
            quillEditor.on('text-change', () => {
                updatePreview();
                scheduleAutoSave();
            });
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            if (!currentArticle) return;

            const title = document.getElementById('input-title')?.value || '';
            const category = document.getElementById('input-category')?.value || '';
            const author = document.getElementById('input-author')?.value || '';
            const date = document.getElementById('input-date')?.value || '';
            const coverImage = document.getElementById('input-cover')?.value || '';
            const content = quillEditor ? quillEditor.root.innerHTML : '';

            const coverHTML = coverImage 
                ? '<img src="' + coverImage + '" alt="å°é¢" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 8px; margin-bottom: 20px;">'
                : '';

            const previewContent = document.getElementById('preview-content');
            previewContent.innerHTML = `
                <div class="preview-article">
                    <h1>${title || 'æ— æ ‡é¢˜'}</h1>
                    <div class="meta">
                        ğŸ“… ${date} | âœï¸ ${author} | ğŸ“ ${category}
                    </div>
                    ${coverHTML}
                    <div class="content">
                        ${content || '<p style="color: #999;">å¼€å§‹ç¼–å†™å†…å®¹...</p>'}
                    </div>
                </div>
            `;
        }

        // è‡ªåŠ¨ä¿å­˜
        function scheduleAutoSave() {
            clearTimeout(autoSaveTimer);
            updateStatus('æœªä¿å­˜', 'unsaved');
            
            autoSaveTimer = setTimeout(() => {
                saveCurrentArticle(true);
            }, 2000);
        }

        // ä¿å­˜å½“å‰æ–‡ç« 
        function saveCurrentArticle(isAutoSave = false) {
            if (!currentArticle) return;

            currentArticle.title = document.getElementById('input-title').value;
            currentArticle.category = document.getElementById('input-category').value;
            currentArticle.author = document.getElementById('input-author').value;
            currentArticle.date = document.getElementById('input-date').value;
            currentArticle.excerpt = document.getElementById('input-excerpt').value;
            currentArticle.coverImage = document.getElementById('input-cover').value;
            currentArticle.visibility = document.getElementById('input-visibility').value;
            currentArticle.content = quillEditor ? quillEditor.root.innerHTML : '';

            saveArticles();
            renderArticleList();
            
            if (!isAutoSave) {
                updateStatus('å·²ä¿å­˜', 'saved');
                setTimeout(() => updateStatus('å°±ç»ª'), 2000);
            } else {
                updateStatus('è‡ªåŠ¨ä¿å­˜', 'saved');
            }
        }

        // ç”Ÿæˆæ–‡ä»¶å
        function generateFilename(title) {
            return title
                .toLowerCase()
                .replace(/[^\w\u4e00-\u9fa5]+/g, '-')
                .replace(/^-+|-+$/g, '')
                .substring(0, 50) + '.html';
        }

        // ç”Ÿæˆå•ç¯‡æ–‡ç«  HTML
        function generateArticleHTML(article) {
            const category = article.category || 'æœªåˆ†ç±»';
            const filename = generateFilename(article.title);
            const coverImageHTML = article.coverImage 
                ? '<img src="' + article.coverImage + '" alt="' + article.title + '" class="post-cover">' 
                : '';
            
            const html = '<!DOCTYPE html>\n' +
'<html lang="zh-CN">\n' +
'<head>\n' +
'    <meta charset="UTF-8">\n' +
'    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n' +
'    <title>' + article.title + ' - æˆ‘çš„ä¸ªäººåšå®¢</title>\n' +
'    <link rel="stylesheet" href="../../css/style.css">\n' +
'    <meta name="description" content="' + article.excerpt + '">\n' +
'    <meta name="keywords" content="' + category + ', ' + article.title + '">\n' +
'</head>\n' +
'<body>\n' +
'    <header>\n' +
'        <nav class="container">\n' +
'            <h1 class="logo">æˆ‘çš„åšå®¢</h1>\n' +
'            <ul class="nav-links">\n' +
'                <li><a href="../../index.html">é¦–é¡µ</a></li>\n' +
'                <li><a href="../../about.html">å…³äº</a></li>\n' +
'            </ul>\n' +
'        </nav>\n' +
'    </header>\n' +
'\n' +
'    <main class="container">\n' +
'        <article class="post-detail">\n' +
'            <header class="post-header">\n' +
'                <h1>' + article.title + '</h1>\n' +
'                <div class="post-meta">\n' +
'                    <span>ğŸ“… ' + article.date + '</span>\n' +
'                    <span>âœï¸ ' + article.author + '</span>\n' +
'                    <span>ğŸ“ ' + category + '</span>\n' +
'                </div>\n' +
'            </header>\n' +
'            ' + coverImageHTML + '\n' +
'            <div class="post-content">\n' +
'                ' + article.content + '\n' +
'            </div>\n' +
'        </article>\n' +
'        \n' +
'        <div class="post-navigation">\n' +
'            <a href="../../index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>\n' +
'        </div>\n' +
'    </main>\n' +
'\n' +
'    <footer>\n' +
'        <div class="container">\n' +
'            <p>&copy; 2025 æˆ‘çš„åšå®¢. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>\n' +
'        </div>\n' +
'    </footer>\n' +
'\n' +
'    <script src="../../js/bing-wallpaper.js"><\/script>\n' +
'    <script>\n' +
'        document.addEventListener(\'DOMContentLoaded\', async () => {\n' +
'            await applyBingWallpaperToBody({\n' +
'                overlay: true,\n' +
'                overlayColor: \'rgba(255, 255, 255, 0.1)\'\n' +
'            });\n' +
'            document.body.classList.add(\'has-wallpaper\');\n' +
'        });\n' +
'    <\/script>\n' +
'</body>\n' +
'</html>';
            
            return { html, filename, category };
        }

        // ç”Ÿæˆå½“å‰æ–‡ç«  HTML
        function generateCurrentHTML() {
            if (!currentArticle) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ç¯‡æ–‡ç« ');
                return;
            }

            saveCurrentArticle();
            
            const { html, filename, category } = generateArticleHTML(currentArticle);
            
            const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = category + '-' + filename;
            a.click();
            URL.revokeObjectURL(url);
            
            updateStatus('HTML å·²ç”Ÿæˆï¼š' + filename, 'saved');
        }

        // ç”Ÿæˆæ‰€æœ‰æ–‡ç«  HTML
        function generateAllHTML() {
            if (articles.length === 0) {
                alert('æ²¡æœ‰æ–‡ç« å¯ç”Ÿæˆ');
                return;
            }

            if (!confirm(`ç¡®å®šè¦ç”Ÿæˆ ${articles.length} ç¯‡æ–‡ç« çš„ HTML æ–‡ä»¶å—ï¼Ÿ`)) {
                return;
            }

            updateStatus('æ­£åœ¨ç”Ÿæˆ...', 'unsaved');

            articles.forEach((article, index) => {
                setTimeout(() => {
                    const { html, filename, category } = generateArticleHTML(article);
                    
                    const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = category + '-' + filename;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    if (index === articles.length - 1) {
                        updateStatus('æ‰€æœ‰æ–‡ç« å·²ç”Ÿæˆ', 'saved');
                    }
                }, index * 500);
            });
        }

        // å¯¼å‡º index.json
        function exportIndexJSON() {
            if (articles.length === 0) {
                alert('æ²¡æœ‰æ–‡ç« å¯å¯¼å‡º');
                return;
            }

            const indexData = {
                posts: articles.map(article => {
                    const category = article.category || 'æœªåˆ†ç±»';
                    const filename = generateFilename(article.title);
                    
                    return {
                        id: article.id,
                        title: article.title,
                        date: article.date,
                        author: article.author,
                        category: category,
                        excerpt: article.excerpt,
                        coverImage: article.coverImage || '',
                        url: 'posts/' + category + '/' + filename,
                        visibility: article.visibility || 'public'
                    };
                })
            };

            const json = JSON.stringify(indexData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'index.json';
            a.click();
            URL.revokeObjectURL(url);
            
            updateStatus('index.json å·²å¯¼å‡º', 'saved');
        }

        // åˆ‡æ¢é¢„è§ˆ
        function togglePreview() {
            const previewArea = document.getElementById('preview-area');
            previewArea.style.display = previewArea.style.display === 'none' ? 'flex' : 'none';
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(text, type = '') {
            const statusEl = document.getElementById('status-text');
            statusEl.textContent = text;
            statusEl.className = type ? 'status-' + type : '';
        }

        // æ›´æ–°æ–‡ç« è®¡æ•°
        function updateArticleCount() {
            document.getElementById('article-count').textContent = 'å…± ' + articles.length + ' ç¯‡æ–‡ç« ';
        }

        // å¤„ç†å°é¢å›¾ç‰‡ä¸Šä¼ 
        function handleCoverUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // æ£€æŸ¥æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }

            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ 5MBï¼‰
            if (file.size > 5 * 1024 * 1024) {
                alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MBï¼å»ºè®®ä½¿ç”¨å›¾åºŠæœåŠ¡ã€‚');
                return;
            }

            // æ˜¾ç¤ºè­¦å‘Šï¼ˆå¦‚æœå›¾ç‰‡è¾ƒå¤§ï¼‰
            if (file.size > 500 * 1024) {
                if (!confirm('å›¾ç‰‡å¤§å°è¶…è¿‡ 500KBï¼Œå»ºè®®å‹ç¼©åä¸Šä¼ æˆ–ä½¿ç”¨å›¾åºŠæœåŠ¡ã€‚\n\nå¤§å›¾ç‰‡ä¼šå¯¼è‡´ï¼š\n- æ–‡ä»¶ä½“ç§¯å¤§\n- åŠ è½½é€Ÿåº¦æ…¢\n- å ç”¨å­˜å‚¨ç©ºé—´\n\næ˜¯å¦ç»§ç»­ï¼Ÿ')) {
                    event.target.value = '';
                    return;
                }
            }

            // è¯»å–æ–‡ä»¶å¹¶è½¬æ¢ä¸º Base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                document.getElementById('input-cover').value = base64;
                showCoverPreview(base64);
                updatePreview();
                scheduleAutoSave();
            };
            reader.readAsDataURL(file);
        }

        // è¾“å…¥å°é¢ URL
        function inputCoverURL() {
            const url = prompt('è¯·è¾“å…¥å›¾ç‰‡ URL:', 'https://');
            if (url && url !== 'https://') {
                document.getElementById('input-cover').value = url;
                showCoverPreview(url);
                updatePreview();
                scheduleAutoSave();
            }
        }

        // æ˜¾ç¤ºå°é¢é¢„è§ˆ
        function showCoverPreview(imageUrl) {
            const preview = document.getElementById('cover-preview');
            if (imageUrl) {
                preview.innerHTML = '<img src="' + imageUrl + '" alt="å°é¢é¢„è§ˆ" style="max-width: 100%; max-height: 200px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">';
                preview.style.display = 'block';
            } else {
                preview.innerHTML = '';
                preview.style.display = 'none';
            }
        }

        // æ¸…é™¤å°é¢å›¾ç‰‡
        function clearCoverImage() {
            document.getElementById('input-cover').value = '';
            document.getElementById('cover-file-input').value = '';
            showCoverPreview('');
            updatePreview();
            scheduleAutoSave();
        }

        // åˆ‡æ¢æ‰¹é‡æ¨¡å¼
        function toggleBatchMode() {
            batchMode = !batchMode;
            document.getElementById('batch-mode-checkbox').checked = batchMode;
            document.getElementById('batch-actions').classList.toggle('active', batchMode);
            
            if (!batchMode) {
                selectedArticles.clear();
            }
            
            renderArticleList();
        }

        // å¤„ç†æ–‡ç« ç‚¹å‡»
        function handleArticleClick(index, event) {
            if (batchMode) {
                toggleArticleSelection(index, event);
            } else {
                loadArticle(index);
            }
        }

        // åˆ‡æ¢æ–‡ç« é€‰æ‹©çŠ¶æ€
        function toggleArticleSelection(index, event) {
            event.stopPropagation();
            
            const article = articles[index];
            if (selectedArticles.has(article.id)) {
                selectedArticles.delete(article.id);
            } else {
                selectedArticles.add(article.id);
            }
            
            renderArticleList();
        }

        // å…¨é€‰æ–‡ç« 
        function selectAllArticles() {
            articles.forEach(article => {
                selectedArticles.add(article.id);
            });
            renderArticleList();
        }

        // å–æ¶ˆå…¨é€‰
        function deselectAllArticles() {
            selectedArticles.clear();
            renderArticleList();
        }

        // åˆ é™¤é€‰ä¸­çš„æ–‡ç« 
        function deleteSelectedArticles() {
            if (selectedArticles.size === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„æ–‡ç« ');
                return;
            }

            if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedArticles.size} ç¯‡æ–‡ç« å—ï¼Ÿ\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }

            // åˆ é™¤é€‰ä¸­çš„æ–‡ç« 
            articles = articles.filter(article => !selectedArticles.has(article.id));
            
            // å¦‚æœå½“å‰ç¼–è¾‘çš„æ–‡ç« è¢«åˆ é™¤ï¼Œæ¸…ç©ºç¼–è¾‘å™¨
            if (currentArticle && selectedArticles.has(currentArticle.id)) {
                currentArticle = null;
                const editorContent = document.getElementById('editor-content');
                editorContent.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“</div>
                        <p>é€‰æ‹©ä¸€ç¯‡æ–‡ç« å¼€å§‹ç¼–è¾‘ï¼Œæˆ–åˆ›å»ºæ–°æ–‡ç« </p>
                    </div>
                `;
                document.getElementById('editor-title').textContent = 'é€‰æ‹©æˆ–åˆ›å»ºä¸€ç¯‡æ–‡ç« ';
            }

            selectedArticles.clear();
            saveArticles();
            renderArticleList();
            
            updateStatus(`å·²åˆ é™¤ ${selectedArticles.size} ç¯‡æ–‡ç« `, 'saved');
        }

        // æ›´æ–°é€‰ä¸­è®¡æ•°
        function updateSelectedCount() {
            document.getElementById('selected-count').textContent = selectedArticles.size;
        }

        // ä»ä»“åº“å¯¼å…¥æ–‡ç« 
        async function importFromRepository() {
            try {
                updateStatus('æ­£åœ¨ä»ä»“åº“è¯»å–æ–‡ç« ...', 'unsaved');
                
                // è¯»å– posts/index.json
                const response = await fetch('posts/index.json');
                if (!response.ok) {
                    throw new Error('æ— æ³•è¯»å– posts/index.json');
                }
                
                const data = await response.json();
                const posts = data.posts || [];
                
                if (posts.length === 0) {
                    alert('ä»“åº“ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡ç« ');
                    updateStatus('å°±ç»ª');
                    return;
                }
                
                // æ˜¾ç¤ºå¯¼å…¥å¯¹è¯æ¡†
                showImportDialog(posts);
                
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                alert('ä»ä»“åº“å¯¼å…¥å¤±è´¥ï¼š' + error.message + '\n\nè¯·ç¡®ä¿ï¼š\n1. posts/index.json æ–‡ä»¶å­˜åœ¨\n2. æ–‡ä»¶æ ¼å¼æ­£ç¡®\n3. åœ¨ Web æœåŠ¡å™¨ç¯å¢ƒä¸‹è¿è¡Œ');
                updateStatus('å¯¼å…¥å¤±è´¥', 'unsaved');
            }
        }

        // æ˜¾ç¤ºå¯¼å…¥å¯¹è¯æ¡†
        function showImportDialog(posts) {
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: white;
                border-radius: 8px;
                padding: 30px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            
            dialog.innerHTML = `
                <h2 style="margin-bottom: 20px; color: #333;">ğŸ“¥ ä»ä»“åº“å¯¼å…¥æ–‡ç« </h2>
                <p style="color: #666; margin-bottom: 20px;">
                    æ‰¾åˆ° ${posts.length} ç¯‡æ–‡ç« ã€‚é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ç« ï¼š
                </p>
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                        <input type="checkbox" id="select-all-import" onchange="toggleAllImport(this)">
                        <span style="font-weight: 500;">å…¨é€‰ / å–æ¶ˆå…¨é€‰</span>
                    </label>
                </div>
                <div id="import-list" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                    ${posts.map((post, index) => `
                        <label style="display: flex; align-items: center; gap: 10px; padding: 12px; margin-bottom: 8px; background: #f8f9fa; border-radius: 4px; cursor: pointer; transition: all 0.3s;">
                            <input type="checkbox" class="import-checkbox" data-index="${index}" checked>
                            <div style="flex: 1;">
                                <div style="font-weight: 500; color: #333; margin-bottom: 4px;">${post.title}</div>
                                <div style="font-size: 12px; color: #999;">
                                    <span style="background: #667eea; color: white; padding: 2px 8px; border-radius: 3px; margin-right: 8px;">${post.category}</span>
                                    <span>${post.date}</span>
                                </div>
                            </div>
                        </label>
                    `).join('')}
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="confirmImport()" style="flex: 1;">
                        âœ… å¯¼å…¥é€‰ä¸­çš„æ–‡ç« 
                    </button>
                    <button class="btn btn-secondary" onclick="closeImportDialog()" style="flex: 1;">
                        âŒ å–æ¶ˆ
                    </button>
                </div>
            `;
            
            modal.appendChild(dialog);
            document.body.appendChild(modal);
            
            // ä¿å­˜æ•°æ®åˆ°å…¨å±€å˜é‡
            window.importPosts = posts;
            window.importModal = modal;
        }

        // åˆ‡æ¢å…¨é€‰
        function toggleAllImport(checkbox) {
            const checkboxes = document.querySelectorAll('.import-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
        }

        // ç¡®è®¤å¯¼å…¥
        async function confirmImport() {
            const checkboxes = document.querySelectorAll('.import-checkbox:checked');
            const selectedIndices = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
            
            if (selectedIndices.length === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ç¯‡æ–‡ç« ');
                return;
            }
            
            updateStatus('æ­£åœ¨å¯¼å…¥æ–‡ç« ...', 'unsaved');
            
            let successCount = 0;
            let failCount = 0;
            
            for (const index of selectedIndices) {
                const post = window.importPosts[index];
                
                try {
                    // è¯»å–æ–‡ç«  HTML å†…å®¹
                    const response = await fetch(post.url);
                    if (!response.ok) {
                        throw new Error('æ— æ³•è¯»å–æ–‡ç« æ–‡ä»¶');
                    }
                    
                    const html = await response.text();
                    
                    // è§£æ HTML æå–å†…å®¹
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const contentEl = doc.querySelector('.post-content');
                    const content = contentEl ? contentEl.innerHTML : '';
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                    const exists = articles.some(a => a.id === post.id);
                    
                    if (exists) {
                        // æ›´æ–°ç°æœ‰æ–‡ç« 
                        const existingIndex = articles.findIndex(a => a.id === post.id);
                        articles[existingIndex] = {
                            id: post.id,
                            title: post.title,
                            category: post.category,
                            author: post.author,
                            date: post.date,
                            excerpt: post.excerpt,
                            coverImage: post.coverImage,
                            content: content,
                            visibility: post.visibility || 'public'
                        };
                    } else {
                        // æ·»åŠ æ–°æ–‡ç« 
                        articles.push({
                            id: post.id,
                            title: post.title,
                            category: post.category,
                            author: post.author,
                            date: post.date,
                            excerpt: post.excerpt,
                            coverImage: post.coverImage,
                            content: content,
                            visibility: post.visibility || 'public'
                        });
                    }
                    
                    successCount++;
                    
                } catch (error) {
                    console.error('å¯¼å…¥æ–‡ç« å¤±è´¥:', post.title, error);
                    failCount++;
                }
            }
            
            // ä¿å­˜å¹¶æ›´æ–°
            saveArticles();
            renderArticleList();
            closeImportDialog();
            
            // æ˜¾ç¤ºç»“æœ
            const message = `å¯¼å…¥å®Œæˆï¼\n\næˆåŠŸï¼š${successCount} ç¯‡\nå¤±è´¥ï¼š${failCount} ç¯‡`;
            alert(message);
            updateStatus(`å·²å¯¼å…¥ ${successCount} ç¯‡æ–‡ç« `, 'saved');
        }

        // å…³é—­å¯¼å…¥å¯¹è¯æ¡†
        function closeImportDialog() {
            if (window.importModal) {
                document.body.removeChild(window.importModal);
                window.importModal = null;
                window.importPosts = null;
            }
            updateStatus('å°±ç»ª');
        }
    </script>
</body>
</html>
