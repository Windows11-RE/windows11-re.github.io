<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章编辑器 - 后台管理系统</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <nav class="container">
            <h1 class="logo">博客后台</h1>
            <ul class="nav-links">
                <li><a href="index.html">前台首页</a></li>
                <li><a href="admin.html">文章管理</a></li>
                <li><a href="github-config.html">GitHub 配置</a></li>
                <li><a href="#" onclick="logout(); return false;" class="logout-link">🚪 登出</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <div class="editor-container">
            <div class="editor-header">
                <h2 id="editor-title">✍️ 编辑文章</h2>
                <div class="editor-actions">
                    <button class="btn btn-secondary" onclick="showPostStats()" id="stats-btn" style="display: none;">
                        📊 统计
                    </button>
                    <button class="btn btn-secondary" onclick="previewPost()">👁️ 预览</button>
                    <button class="btn" onclick="savePost()">💾 保存</button>
                    <a href="admin.html" class="btn btn-secondary">← 返回</a>
                </div>
            </div>

            <form id="post-editor-form" class="post-editor-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="post-title">文章标题 *</label>
                        <input type="text" id="post-title" placeholder="输入文章标题" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="post-category">分类 *</label>
                        <div class="category-select-container">
                            <select id="post-category" required>
                                <option value="">选择分类</option>
                            </select>
                            <button type="button" class="btn-manage-categories" onclick="openCategoryManager()" title="管理分类">
                                ⚙️
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="post-author">作者</label>
                        <input type="text" id="post-author" placeholder="作者名称" value="博主">
                    </div>
                    <div class="form-group">
                        <label for="post-visibility">可见性 *</label>
                        <select id="post-visibility" required>
                            <option value="public">🌍 公开 - 所有人可见</option>
                            <option value="private">🔒 私密 - 仅自己可见</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post-excerpt">摘要 *</label>
                    <textarea id="post-excerpt" rows="2" placeholder="文章摘要（显示在列表中）" required></textarea>
                </div>

                <div class="form-group">
                    <label for="post-cover">封面图片</label>
                    <div class="image-upload-container">
                        <input type="text" id="post-cover" placeholder="图片 URL 或上传本地图片" readonly>
                        <div class="image-upload-buttons">
                            <button type="button" class="btn-upload" onclick="document.getElementById('cover-file-input').click()">
                                📁 选择本地图片
                            </button>
                            <button type="button" class="btn-upload" onclick="inputCoverUrl()">
                                🔗 输入 URL
                            </button>
                            <button type="button" class="btn-upload btn-clear" onclick="clearCoverImage()">
                                ✕ 清除
                            </button>
                        </div>
                        <input type="file" id="cover-file-input" accept="image/*" style="display: none;" onchange="handleCoverImageUpload(event)">
                        <div id="cover-preview" class="image-preview"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="post-content">文章内容 * (支持 Markdown)</label>
                    <div class="editor-toolbar">
                        <button type="button" class="toolbar-btn" onclick="insertFormat('bold')" title="粗体">
                            <strong>B</strong>
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('italic')" title="斜体">
                            <em>I</em>
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('heading')" title="标题">
                            H
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('code')" title="代码">
                            &lt;/&gt;
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('link')" title="链接">
                            🔗
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('image')" title="图片">
                            🖼️
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('list')" title="列表">
                            📝
                        </button>
                        <button type="button" class="toolbar-btn" onclick="insertFormat('quote')" title="引用">
                            💬
                        </button>
                    </div>
                    <textarea id="post-content" rows="20" placeholder="使用 Markdown 格式编写文章内容..." required></textarea>
                </div>
            </form>
        </div>

        <!-- 预览模态框 -->
        <div id="preview-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📄 文章预览</h3>
                    <button class="modal-close" onclick="closePreview()">×</button>
                </div>
                <div class="modal-body" id="preview-content">
                    <!-- 预览内容 -->
                </div>
            </div>
        </div>

        <!-- 分类管理模态框 -->
        <div id="category-modal" class="modal">
            <div class="modal-content category-modal-content">
                <div class="modal-header">
                    <h3>📁 分类管理</h3>
                    <button class="modal-close" onclick="closeCategoryManager()">×</button>
                </div>
                <div class="modal-body">
                    <!-- 添加新分类 -->
                    <div class="category-add-section">
                        <h4>添加新分类</h4>
                        <div class="category-add-form">
                            <input type="text" id="new-category-name" placeholder="输入新分类名称" maxlength="20">
                            <button class="btn" onclick="addNewCategory()">+ 添加</button>
                        </div>
                    </div>

                    <!-- 分类列表 -->
                    <div class="category-list-section">
                        <h4>现有分类</h4>
                        <div id="category-list" class="category-list">
                            <!-- 分类列表将在这里显示 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 文章统计模态框 -->
        <div id="stats-modal" class="modal">
            <div class="modal-content stats-modal-content">
                <div class="modal-header">
                    <h3>📊 文章统计数据</h3>
                    <button class="modal-close" onclick="closeStatsModal()">×</button>
                </div>
                <div class="modal-body">
                    <div id="stats-content" class="stats-content">
                        <!-- 统计内容将在这里显示 -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 我的博客. 保留所有权利.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/categories.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/bing-wallpaper.js"></script>
    <script src="js/editor.js"></script>
    <script>
        // 应用必应每日一图背景
        document.addEventListener('DOMContentLoaded', async () => {
            await applyBingWallpaperToBody({
                overlay: true,
                overlayColor: 'rgba(255, 255, 255, 0.15)'
            });
            document.body.classList.add('has-wallpaper');
        });
    </script>
</body>
</html>
