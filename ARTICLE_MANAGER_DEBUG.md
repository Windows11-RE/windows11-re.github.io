# 🔧 文章管理器调试指南

## 🐛 保存功能问题排查

### 步骤 1：打开文章管理器
打开 `article-manager.html`

### 步骤 2：打开浏览器控制台
按 `F12` 打开开发者工具，切换到 Console 标签

### 步骤 3：创建或选择文章
1. 点击"+ 新建文章"
2. 或点击左侧列表中的文章

### 步骤 4：编辑内容
1. 输入标题
2. 输入分类
3. 输入摘要
4. 在编辑器中输入内容

### 步骤 5：测试保存
点击底部的"🧪 测试保存"按钮

**控制台应该显示：**
```
=== 保存功能测试 ===
当前文章: {id: 123, title: "...", ...}
文章数组: [{...}, {...}]
Quill 编辑器: Quill {...}
标题元素: <input id="input-title">
分类元素: <input id="input-category">
标题值: "我的文章"
分类值: "技术"
开始保存文章: 123
文章数据已更新: {...}
已保存到 localStorage
列表已更新
localStorage 中的数据: "[{...}]"
```

### 步骤 6：手动保存
点击"💾 保存"按钮

**应该看到：**
- 状态栏显示"✅ 已保存"
- 控制台显示保存日志
- 左侧列表更新

### 步骤 7：测试自动保存
1. 在编辑器中输入内容
2. 等待 2 秒
3. 状态栏应该显示"💾 自动保存"

## 🔍 常见问题

### 问题 1：点击保存没反应

**可能原因：**
- 没有选中文章
- 表单元素未加载
- JavaScript 错误

**排查方法：**
1. 查看控制台是否有错误
2. 点击"🧪 测试保存"查看详细信息
3. 确认是否选中了文章（左侧列表有蓝色高亮）

### 问题 2：自动保存不工作

**可能原因：**
- Quill 编辑器未初始化
- 事件监听器未绑定

**排查方法：**
1. 在控制台输入：`quillEditor`
2. 应该显示 Quill 对象，而不是 `null`
3. 在编辑器中输入内容，查看控制台是否有"触发自动保存"

### 问题 3：保存后数据丢失

**可能原因：**
- localStorage 被禁用
- 浏览器隐私模式

**排查方法：**
1. 在控制台输入：`localStorage.getItem('articles')`
2. 应该显示 JSON 字符串
3. 检查浏览器设置，确保允许 localStorage

### 问题 4：状态栏不更新

**可能原因：**
- `updateStatus` 函数有问题
- 元素 ID 不匹配

**排查方法：**
1. 在控制台输入：`document.getElementById('status-text')`
2. 应该返回元素，而不是 `null`

## 🧪 手动测试命令

在浏览器控制台运行以下命令：

### 测试 1：检查当前文章
```javascript
console.log('当前文章:', currentArticle);
```

### 测试 2：检查文章数组
```javascript
console.log('所有文章:', articles);
```

### 测试 3：检查 Quill 编辑器
```javascript
console.log('Quill 编辑器:', quillEditor);
console.log('编辑器内容:', quillEditor?.root.innerHTML);
```

### 测试 4：手动保存
```javascript
saveCurrentArticle(false);
```

### 测试 5：查看 localStorage
```javascript
console.log('localStorage:', localStorage.getItem('articles'));
```

### 测试 6：手动触发自动保存
```javascript
scheduleAutoSave();
```

## ✅ 改进内容

### 1. 增强的错误处理
- ✅ 添加了 try-catch 错误捕获
- ✅ 检查必需元素是否存在
- ✅ 详细的错误提示

### 2. 详细的日志
- ✅ 每个步骤都有 console.log
- ✅ 方便追踪执行过程
- ✅ 快速定位问题

### 3. 测试功能
- ✅ "🧪 测试保存"按钮
- ✅ 显示详细的调试信息
- ✅ 验证保存结果

### 4. 统一的输入处理
- ✅ 创建了 `handleInputChange()` 函数
- ✅ 同时触发预览和自动保存
- ✅ 所有输入框使用相同的处理

## 🎯 验证保存功能

### 正常工作的标志

1. **手动保存**
   - 点击"💾 保存"
   - 状态栏显示"✅ 已保存"
   - 控制台显示保存日志
   - 左侧列表更新

2. **自动保存**
   - 输入内容后等待 2 秒
   - 状态栏显示"💾 自动保存"
   - 控制台显示"触发自动保存"

3. **数据持久化**
   - 刷新页面
   - 文章列表仍然存在
   - 点击文章，内容正确显示

## 🔧 如果仍然不工作

### 方法 1：清除缓存
```javascript
// 在控制台运行
localStorage.clear();
location.reload();
```

### 方法 2：检查浏览器设置
- 确保允许 localStorage
- 不要使用隐私/无痕模式
- 检查浏览器版本（建议使用最新版）

### 方法 3：查看完整错误
在控制台查看是否有红色错误信息，并提供给我。

## 📝 使用建议

### 正确的使用流程
```
1. 打开 article-manager.html
2. 点击"+ 新建文章"
3. 填写标题、分类、摘要
4. 在编辑器中输入内容
5. 等待 2 秒（自动保存）
6. 或点击"💾 保存"（手动保存）
7. 状态栏显示"已保存"
8. 点击"📄 生成 HTML"
```

### 验证保存成功
```
1. 刷新页面（F5）
2. 左侧列表应该显示文章
3. 点击文章
4. 内容应该正确显示
```

## 🎊 总结

现在文章管理器有了：

- ✅ **详细的日志** - 方便调试
- ✅ **错误处理** - 捕获并提示错误
- ✅ **测试功能** - 快速验证保存
- ✅ **统一的输入处理** - 自动保存和预览
- ✅ **状态提示** - 实时反馈

请打开文章管理器，按 F12 查看控制台，然后点击"🧪 测试保存"按钮，告诉我控制台显示了什么！
